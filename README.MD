# Тестовое задание на курс "Python" от ШИФТ ЦФТ
## Rest-cервис просмотра текущей зарплаты и даты следующего повышения

### Описание задачи
В данном репозитории находится выполненное тестовое задание. Реализован REST-сервис просмотра текущей заработной платы 
и даты следующего повышения. Так как данные очень важны и критичны, каждый сотрудник может видеть свою сумму. Реализован
метод, где по логину и паролю сотрудника выдается секретный токен, который действует в течение определенного времени. 
Запрос данных о зарплате выдается только при предъявлении валидного токена.

### Требования к решению
Были выполнены все обязательные требования:
* код размещен и доступен в <i><u>публичном</u></i> репозитории на GitLab;
* оформлена инструкция по запуску сервиса и взаимодействую с проектом (Markdown файл с использованием конструкций
разметки от GitLab по необходимости);
* сервис реализован на FastAPI.

Кроме этого, были выполнены два необязательных требования:
* написаны тесты с ипользованием pytest;
* реализована возможность собирать и запускать контейнер с сервисом в Docker.

### Краткое описание решения
В данном репозитории представлен работающий сервис, а также PostgreSQL с имеющимися в ней данными. В данном сервисе
реализовано 2 endpoint'a:

* /user/login - Получение пользователем секретного токена при предъявлении правильных логина и пароля. 
Токен валиден в течение 2 минут;
* /user/salary_info - Получение пользователем информации о своей заработной плате и о дате ее будущего повышения.<br>

В данном сервисе не предусмотрена возможность регистрации. Подразумевается, что в данном сервисе пользователя
авторизирует компания, владеющая данным сервисом. После регистрации она выдает сотруднику логин и пароль для просмотра 
личной информации. 

В файле [extended_database.xlsx](https://github.com/wafflelios/REST-service/blob/main/extended_database.xlsx) можно ознакомиться с информацией, которая размещена в PostgreSQL. Важно, что колонка 
password отсутсвует в PostgreSQL. Сделано это для того, чтобы исбежать кражи паролей пользоватей при доступе 
злоумышленников к базе данных. 

Самые важные библиотеки, использованные в данном проекте:

* бэкенд - [FastAPI](https://fastapi.tiangolo.com/ru/)
* секретные токены - [PyJWT](https://pyjwt.readthedocs.io/en/latest/)
* хэширование паролей - [bcrypt](https://pypi.org/project/bcrypt/)

### Как запустить сервис?
Проект можно запустить двумя способами: через [uvicorn](https://www.uvicorn.org) и через [Docker](https://www.docker.com).
Ниже будут рассмотрены оба варианта.

### Запуск сервиса через uvicorn
1. Скачайте все файлы проекта;
2. Извлеките данные из [db.zip](https://github.com/wafflelios/REST-service/blob/main/db.zip) в папку с проектом;
3. Откройте папку с проектом в терминале, создайте и активируйте виртуальное окружение с помощью команды:
```
python3 -m venv venv
source ./bin/activate
```
4. Установите необходимые зависимости с помощью команды:
```
pip install -r requirements.txt
```
5. Соберите и запустите Docker Compose с базой данных с помощью команд:
```
docker compose build
docker compose up
```
6. Откройте еще один терминал, перейдите в папку src и запустите сервис:
```
cd src
uvicorn main:app --reload
```

### Запуск сервиса с помощью Docker Compose и DockerHub
1. Из данного репозитория скачайте папку [run_by_docker](https://github.com/wafflelios/REST-service/tree/main/run_by_docker) и файл [db.zip](https://github.com/wafflelios/REST-service/blob/main/db.zip);
2. Извлеките данные из [db.zip](https://github.com/wafflelios/REST-service/blob/main/db.zip) в папку [run_by_docker](https://github.com/wafflelios/REST-service/tree/main/run_by_docker);
3. Откройте терминал в данной директории и скачайте образ сервиса из DockerHub с помощью команды:
```
docker pull wafflelios/rest-service
```
4. Соберите и запустите Docker Compose с базой данных и сервисом с помощью команд:
```
docker compose build
docker compose up
```

### Как пользоваться сервисом?
Откройте браузер и в адресной строке перейдите по адресу http://localhost:8000/docs, если вы запускали сервис через 
uvicorn, или http://localhost:9999/docs, если запускали через Docker. <br> 
Добро пожаловать в интерактивную документацию FastAPI, в которой можно повзаимодействовать с сервисом.

![](https://i.imgur.com/60keTGF.png)

Откроем [extended_database.xlsx](https://github.com/wafflelios/REST-service/blob/main/extended_database.xlsx) и попробуем получить токен для первого работника из базы данных.

![](https://i.imgur.com/EyUJxma.png)

![](https://i.imgur.com/8wczKwV.png)

В ответе получаем секретный токен, копируем его.

![](https://i.imgur.com/xV5hXy5.png)

Переходим ко второму endpoint'у и аналогично первому вводим секретный токен

![](https://i.imgur.com/V2OIphZ.png)

В ответ получаем приветствие, заработную плату работника и дату будущего ее повышения.

![](https://i.imgur.com/rC6KzPL.png)

Сверяем полученные данные: все верно.

![](https://i.imgur.com/j7Gf8zd.png)

### Выше говорилось, что есть тесты к данному проекту, где их посмотреть?
Все тесты расположены в папке tests. Чтобы посмотреть на их работу, выполните следующие шаги (они во многом повторяют 
шаги по запуску проекта на uvicorn, поэтому некоторые из них можно пропустить, если вы их выполняли ранее):
1. Скачайте все файлы проекта;
2. Извлеките данные из [db.zip](https://github.com/wafflelios/REST-service/blob/main/db.zip) в папку с проектом;
3. Откройте папку с проектом в терминале, создайте и активируйте виртуальное окружение с помощью команды:
```
python3 -m venv venv
source ./bin/activate
```
4. Установите необходимые зависимости с помощью команды:
```
pip install -r requirements.txt
```
5. Соберите и запустите Docker Compose с базой данных с помощью команд:
```
docker compose build
docker compose up
```
6. Откройте второй терминал в папке проекта и выполните команду:
```
pytest -v /tests
```

![](https://i.imgur.com/AEKYd1r.png)

### Что можно было бы улучшить?
* Frontend. Его очень сильно не хватает в данном проекте для удобного использования людьми, которые не имеют никакого
отношения к разработке.
* Вместо выдачи секретного токена можно было бы организовать полноценный вход пользователя в аккаунт и выход из него. 
Тогда можно было бы сделать защищенные endpoint'ы, которые смогут просматривать только авторизированные пользователи.
* При выдачи секретного токена можно было бы писать, какое время он будет валидным, но осознала я это только тогда,
когда писала этот Markdown файл.
